@startuml
skinparam sequenceMessageAlign center
skinparam backgroundColor #FEFEFE
skinparam sequenceArrowThickness 2

actor "QL Kho" as User
boundary "GD_Chinh" as GUI_Main
boundary "GD_QuanLyViTri" as View
boundary "GD_SuaBin" as EditModal
control "Ctrl_Location" as Controller
entity "DB_Locations" as LocationDB

title Cập nhật vị trí kho (Bin)

User -> GUI_Main: 1: Chọn "Quản lý vị trí"
activate User
activate GUI_Main

GUI_Main -> View: 1.1: Mở trang quản lý vị trí
activate View
deactivate GUI_Main

View -> View: 1.2: Hiển thị danh sách zones với bins

User -> View: 2: Click "Sửa" bin

View -> Controller: 2.1: getBinData(zone_id, rack_id, bin_id)
activate Controller

Controller -> LocationDB: 2.1.1: Query bin from warehouse
activate LocationDB

LocationDB --> Controller: 2.1.2: return bin data
deactivate LocationDB

Controller --> View: 2.1.3: return bin data
deactivate Controller

View -> EditModal: 2.2: Mở modal sửa bin
activate EditModal

EditModal -> EditModal: 2.3: Fill form với dữ liệu hiện tại

User -> EditModal: 3: Sửa thông tin (tên, kích thước)

User -> EditModal: 4: Click "Lưu"

EditModal -> EditModal: 4.1: Tính status từ current_capacity

EditModal -> EditModal: 4.1: Validate dữ liệu

alt Dữ liệu hợp lệ
    EditModal -> Controller: 4.2: updateBinFull(zone_id, rack_id, bin_id, data)
    activate Controller
    
    Controller -> LocationDB: 4.2.1: Update bin using arrayFilters
    activate LocationDB
    
    LocationDB --> Controller: 4.2.2: Modified count = 1
    deactivate LocationDB
    
    Controller --> EditModal: 4.2.3: return {success: true}
    deactivate Controller
    
    EditModal -> EditModal: 4.3: Hiển thị toast thông báo
    
    EditModal -> View: 4.4: Đóng modal và reload
    deactivate EditModal
    
    View -> View: 4.5: Reload trang
    
    View -> View: 4.6: Hiển thị bin đã cập nhật
    
else Dữ liệu không hợp lệ
    EditModal -> EditModal: 4.7: Hiển thị lỗi validation
    deactivate EditModal
end

deactivate View
deactivate User

@enduml